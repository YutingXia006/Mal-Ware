package malware.client;

import javafx.scene.canvas.GraphicsContext;

public class CanvasPainter {

    GraphicsContext gc;
    InstructionFactory instructionFactory;
    ClientNetInterface clientNetInterface;

    String drawingString;



    public CanvasPainter(GraphicsContext gc, ClientNetInterface clientNetInterface) {

        this.gc = gc;
        this.clientNetInterface = clientNetInterface;
        instructionFactory = new InstructionFactory();
    }


    public void draw(int historyIndex, UserAction action, double x, double y, boolean sendToServer){
        if(UserAction.PRESS == action){
            clientNetInterface.bufferServerInput();
            gc.beginPath();
        }

        gc.lineTo(x,y);



        gc.stroke();

        if (UserAction.RELEASE == action){
            gc.closePath();
            clientNetInterface.dismissServerBuffer();

        }

        if(sendToServer) {
            drawToServer(historyIndex, action, x, y);
        }


    }

    private void drawToServer(int historyIndex, UserAction action, double x, double y){
        drawingString = instructionFactory.createInstruction(
                historyIndex,
                clientNetInterface.getName(),
                action.toString(),
                gc.getStroke().toString(),
                String.valueOf(gc.getLineWidth()),
                x,
                y);

        clientNetInterface.writeToServer(drawingString);
    }

}
