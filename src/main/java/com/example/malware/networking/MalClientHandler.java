package com.example.malware.networking;

import javafx.scene.canvas.GraphicsContext;

import java.io.*;
import java.net.Socket;


public class MalClientHandler implements Runnable {

    private Socket socket;
    private GraphicsContext gc;
    private BufferedReader inputReader;

    public MalClientHandler(Socket socket, GraphicsContext gc) throws IOException {

        this.socket = socket;
        this.gc = gc;

        try {

            inputReader = new BufferedReader(new InputStreamReader(socket.getInputStream()));
        } catch (IOException e) {
            throw new RuntimeException(e);
        }


    }


    public void run() {

        String message;
        while (true) {
            try {
                // TODO: Insert canvas altering methods + switch case to map input to said methods
                if(inputReader.ready()) {
                    message = inputReader.readLine().substring(2);
                    System.out.print(message);
                    String[] variables = message.split(",");
                    gc.beginPath();
                    gc.moveTo(Integer.valueOf(variables[0]), Integer.valueOf(variables[1]));
                    gc.stroke();
                    gc.lineTo(Integer.valueOf(variables[2]), Integer.valueOf(variables[3]));
                    gc.stroke();
                }

            } catch (IOException ex) {
                System.err.println("Error handling client input: " + ex.getMessage());
            }
            if (!socket.isConnected()) {
                System.out.println("Connection lost");
                break;
            }

        }

        try {
            socket.close();
        } catch (IOException e) {
            throw new RuntimeException(e);
        }
    }
}

